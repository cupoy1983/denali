(function(a){a.fn.lazyload=function(e){var b={threshold:0,failurelimit:0,event:"scroll",effect:"show",container:window};e&&a.extend(b,e);var k=this;"scroll"==b.event&&a(b.container).bind("scroll",function(){var c=0;k.each(function(){if(!a.abovethetop(this,b)&&!a.leftofbegin(this,b))if(!a.belowthefold(this,b)&&!a.rightoffold(this,b))a(this).trigger("appear");else if(c++>b.failurelimit&&!FANWE.NO_COUNTER)return!1});var e=a.grep(k,function(a){return!a.loaded});k=a(e)});this.each(function(){var c=this;
void 0==a(c).attr("original")&&a(c).attr("original",a(c).attr("src"));"scroll"!=b.event||void 0==a(c).attr("src")||b.placeholder==a(c).attr("src")||a.abovethetop(c,b)||a.leftofbegin(c,b)||a.belowthefold(c,b)||a.rightoffold(c,b)?(b.placeholder?a(c).attr("src",b.placeholder):a(c).removeAttr("src"),c.loaded=!1):c.loaded=!0;a(c).one("appear",function(){if(!this.loaded){var e=a(c).parent(),d=new Image;d.src=a(c).attr("original");var l=parseInt(a(c).attr("scaleType")),g=parseInt(a(c).attr("scaleWidth")),
h=parseInt(a(c).attr("scaleHeight"));if(isNaN(l)||isNaN(g)||isNaN(h)||1>l||1>g&&1>h)a(c).hide().attr("src",a(c).attr("original"))[b.effect](b.effectspeed),c.loaded=!0,delete d;else{var k=function(){var i=0,j=0,f=d.width/d.height;if(!(0==d.width||0==d.height)){switch(l){case 1:d.width>g?(i=g,j=g/f):(f=g/d.width,i=g,j=d.height*f);break;case 2:d.height>h?(j=h,i=h*f):(f=h/d.height,j=h,i=d.width*f);break;case 3:g/d.width<h/d.height?(f=h/d.height,j=h,i=d.width*f):(f=g/d.width,i=g,j=d.height*f);break;case 4:g/
d.width>h/d.height?(f=h/d.height,j=h,i=d.width*f):(f=g/d.width,i=g,j=d.height*f);break;default:delete d;return}if(3==l){var f=(e.width()-i)/2,k=(e.height()-j)/2;a(c).hide().attr("src",a(c).attr("original")).css({"margin-top":k,"margin-left":f,width:i,height:j})[b.effect](b.effectspeed)}else a(c).hide().attr("src",a(c).attr("original")).css({width:i,height:j})[b.effect](b.effectspeed),"1"==a(c).attr("updateParentSize")&&a(c).parent().css({width:i,height:j})}delete d};d.complete?k():a(d).load(function(){k()})}}});
"scroll"!=b.event&&a(c).bind(b.event,function(){c.loaded||a(c).trigger("appear")})});a(b.container).trigger(b.event);return this};a.belowthefold=function(e,b){return(void 0===b.container||b.container===window?a(window).height()+a(window).scrollTop():a(b.container).offset().top+a(b.container).height())<=a(e).offset().top-b.threshold};a.rightoffold=function(e,b){return(void 0===b.container||b.container===window?a(window).width()+a(window).scrollLeft():a(b.container).offset().left+a(b.container).width())<=
a(e).offset().left-b.threshold};a.abovethetop=function(e,b){return(void 0===b.container||b.container===window?a(window).scrollTop():a(b.container).offset().top)>=a(e).offset().top+b.threshold+a(e).height()};a.leftofbegin=function(e,b){return(void 0===b.container||b.container===window?a(window).scrollLeft():a(b.container).offset().left)>=a(e).offset().left+b.threshold+a(e).width()};a.extend(a.expr[":"],{"below-the-fold":"$.belowthefold(a, {threshold : 0, container: window})","above-the-fold":"!$.belowthefold(a, {threshold : 0, container: window})",
"right-of-fold":"$.rightoffold(a, {threshold : 0, container: window})","left-of-fold":"!$.rightoffold(a, {threshold : 0, container: window})"})})(jQuery);
