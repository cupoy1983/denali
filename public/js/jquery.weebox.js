(function(d){var j={},e=[],n=function(f,c){var a=this;this.options=this.ajaxurl=this.selector=this.db=this.dt=this.dc=this.mh=this.dh=null;this._dragging=!1;this._content=f||"";this._options=c||{};this.ajaxresult=null;this._defaults={boxid:null,boxclass:null,cache:!1,type:"dialog",title:"",width:0,height:0,timeout:0,draggable:!0,modal:!0,focus:null,blur:null,position:"center",topheight:120,overlay:30,showTitle:!0,showButton:!0,showCancel:!0,showHeader:!0,showOk:!0,isFull:!0,isCloseToHide:!1,okBtnName:"\u786e\u5b9a",
cancelBtnName:"\u53d6\u6d88",contentType:"text",contentChange:!1,clickClose:!1,zIndex:999,animate:"",showAnimate:"",hideAnimate:"",onclose:null,onopen:null,onready:null,oncancel:null,onok:null,suggest:{url:"",tele:"",vele:"",fn:null},ajaxdata:null,select:{url:"",type:"radio",tele:"",vele:"",width:120,search:!1,fn:null}};this.initOptions=function(){a._options=a._options||{};a._options.animate=a._options.animate||"";a._options.showAnimate=a._options.showAnimate||a._options.animate;a._options.hideAnimate=
a._options.hideAnimate||a._options.animate;a._options.type=a._options.type||"dialog";a._options.title=a._options.title||"";a._options.boxclass=a._options.boxclass||"wee"+a._options.type;a._options.contentType=a._options.contentType||"";""==a._options.contentType&&(a._options.contentType="#"==a._content.substr(0,1)?"selector":"text");a.options=d.extend({},a._defaults,a._options);a._options=null;a._defaults=null};this.initBox=function(){var b="";switch(a.options.type){case "alert":case "select":case "dialog":b=
'<div class="weedialog">\t<div class="dialog-top">\t\t<div class="dialog-tl"></div>\t\t<div class="dialog-tc"></div>\t\t<div class="dialog-tr"></div>\t</div>\t<table width="100%" border="0" cellspacing="0" cellpadding="0" >\t\t<tr>\t\t\t<td class="dialog-cl"></td>\t\t\t<td>\t\t\t\t<div class="dialog-header">\t\t\t\t\t<div class="dialog-title"></div>\t\t\t\t\t<a href="javascript:;" onclick="return false" class="dialog-close"></a>\t\t\t\t</div>\t\t\t\t<div class="dialog-content"></div>\t\t\t\t<div class="dialog-button">\t\t\t\t\t<input type="button" class="dialog-ok" value="\u786e\u5b9a">\t\t\t\t\t<input type="button" class="dialog-cancel" value="\u53d6\u6d88">\t\t\t\t</div>\t\t\t</td>\t\t\t<td class="dialog-cr"></td>\t\t</tr>\t</table>\t<div class="dialog-bot">\t\t<div class="dialog-bl"></div>\t\t<div class="dialog-bc"></div>\t\t<div class="dialog-br"></div>\t</div></div>';
break;case "custom":case "suggest":b='<div><div class="dialog-content"></div></div>'}a.dh=d(b).appendTo("body").hide().css({position:"absolute",overflow:"hidden",zIndex:a.options.zIndex});a.dc=a.find(".dialog-content");a.dt=a.find(".dialog-title");a.db=a.find(".dialog-button");a.dhh=a.find(".dialog-header");a.options.boxid&&a.dh.attr("id",a.options.boxid);a.options.boxclass&&a.dh.addClass(a.options.boxclass);0<a.options.height&&a.dc.css("height",a.options.height);0<a.options.width&&a.dh.css("width",
a.options.width);a.dh.bgiframe()};this.initMask=function(){a.options.modal&&(d.browser.msie?(h="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight,w="CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth):(h=a.bheight(),w=a.bwidth()),a.mh=d("<div class='dialog-mask'></div>").appendTo("body").hide().css({width:w,height:h,zIndex:a.options.zIndex-1}).bgiframe())};this.initContent=function(){a.dh.find(".dialog-ok").val(a.options.okBtnName);
a.dh.find(".dialog-cancel").val(a.options.cancelBtnName);""!=a.options.title&&a.dt.html(a.options.title);a.options.showTitle||a.dt.hide();a.options.draggable&&a.dt.css({cursor:"move"});a.options.showHeader||a.dhh.remove();a.options.showButton||a.dh.find(".dialog-button").hide();a.options.showCancel||a.dh.find(".dialog-cancel").hide();a.options.showOk||a.dh.find(".dialog-ok").hide();if("suggest"==a.options.type)a.hide(),d(a.options.suggest.tele).unbind("keyup").keyup(function(){var b=d.trim(this.value),
g=null;for(key in j)key==b&&(g=j[key]);null===g&&d.ajax({type:"GET",data:{q:b},url:a.options.suggest.url||a._content,success:function(a){g=a},dataType:"json",async:!1});j[b]=g;b="";for(key in g)b+="<li>"+g[key].name+"</li>";a.show();a.setContent(b);a.find("li").click(function(){var b=a.find("li").index(this);d(a.options.suggest.tele).val(g[b].name);d(a.options.suggest.vele).val(g[b].id);"function"==typeof a.options.suggest.fn&&fn(g[b]);a.hide()})});else if("select"==a.options.type){var b=a.options.select.type||
"radio",g=a.options.select.search||!1;d.ajax({type:"GET",url:a.options.select.url||a._content||"",success:function(c){var e="";if(null===c)e="\u6ca1\u6709\u6570\u636e";else{g&&(e+='<div class="wsearch"><input type="text"><input type="button" value="\u67e5\u8be2"></div>');var f=d.trim(d(a.options.select.vele).val()).split(","),e=e+'<div class="wselect">';for(key in c)var m=-1==d.inArray(c[key].id,f)?"":'checked="checked"',e=e+('<li><label><input name="wchoose" '+m+' type="'+b+'" value="'+c[key].id+
'">'+c[key].name+"</label></li>");e+="</div>"}a.show();a.setContent(e);a.find("li").width(a.options.select.width);a.find(".wsearch input").keyup(function(){var b=d.trim(this.value);a.find("li").hide();for(i in c)(c[i].id==b||-1!=c[i].name.indexOf(b))&&a.find("li:eq("+i+")").show()});a.setOnok(function(){if("radio"==b)if(0==a.find(":checked").length)d(a.options.select.tele).val(""),d(a.options.select.vele).val("");else{var g=a.find(":radio[name=wchoose]").index(a.find(":checked")[0]);d(a.options.select.tele).val(c[g].name);
d(a.options.select.vele).val(c[g].id);"function"==typeof a.options.select.fn&&fn(c[g])}else if(0==a.find(":checked").length)d(a.options.select.tele).val(""),d(a.options.select.vele).val("");else{var e=[],f=[],m=[];a.find(":checked").each(function(){var b=a.find(":checkbox[name=wchoose]").index(this);e.push(c[b]);f.push(c[b].id);m.push(c[b].name)});d(a.options.select.tele).val(m.join(","));d(a.options.select.vele).val(f.join(","));"function"==typeof a.options.select.fn&&fn(e)}a.close()})},dataType:"json"})}else if("selector"==
a.options.contentType){a.show();a.selector=a._content;a._content=d(a.selector).html();a.setContent(a._content);var c=d(a.selector).find(":checkbox");a.dc.find(":checkbox").each(function(a){this.checked=c[a].checked});d(a.selector).empty();a.focus();a.onopen()}else if("ajax"==a.options.contentType)a.ajaxurl=a._content,a.show(),a.setLoading(),a.dh.find(".dialog-button").hide(),!1==a.options.cache&&(a.ajaxurl=-1==a.ajaxurl.indexOf("?")?a.ajaxurl+("?_t="+Math.random()):a.ajaxurl+("&_t="+Math.random())),
null==a.options.ajaxdata?d.get(a.ajaxurl,function(b){a._content=b;a.show();a.setContent(a._content);a.focus();a.onopen()}):d.post(a.ajaxurl,a.options.ajaxdata,function(b){a._content=b.html;delete b.html;a.ajaxresult=b;a.show();a.setContent(a._content);a.focus();a.onopen()},"json");else{if("iframe"==a.options.contentType){var e;e='<style type="text/css">\n.dialog-box .dialog-content{padding:0px;}\n</style>';e+='<iframe class="dialogIframe" src="'+a._content+'" width="100%" height="100%" frameborder="0"></iframe>';
a.show();a.setContent(e)}else a.show(),a.setContent(a._content),a.focus();a.onopen()}};this.initEvent=function(){a.dh.find(".dialog-close,.dialog-cancel, .dialog-ok").unbind("click").click(function(){a.close()});"function"==typeof a.options.onok&&a.dh.find(".dialog-ok").unbind("click").click(function(){a.options.onok(a)});"function"==typeof a.options.oncancel&&a.dh.find(".dialog-cancel").unbind("click").click(function(){a.options.oncancel(a)});0<a.options.timeout&&window.setTimeout(a.close,1E3*a.options.timeout);
this.drag()};this.setOnok=function(b){a.dh.find(".dialog-ok").unbind("click");"function"==typeof b&&a.dh.find(".dialog-ok").click(function(){b(a)})};this.setOncancel=function(b){a.dh.find(".dialog-cancel").unbind("click");"function"==typeof b&&a.dh.find(".dialog-cancel").click(function(){b(a)})};this.setOnclose=function(b){a.options.onclose=b};this.drag=function(){a.options.draggable&&a.options.showTitle&&a.dh.find(".dialog-header").mousedown(function(b){var g=this,c=a.dh.position().left,e=a.dh.position().top,
f=b.clientX,p=b.clientY,l=a.dh.width(),j=a.dh.height(),n=a.bwidth(),q=a.bheight();g.setCapture&&g.setCapture();d(document).mousemove(function(b){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var d=Math.max(c+b.clientX-f,0),b=Math.max(e+b.clientY-p,0),d=Math.min(d,n-l),b=Math.min(b,q-j);a.dh.css({left:d,top:b})}).mouseup(function(){g.releaseCapture&&g.releaseCapture();d(document).unbind("mousemove");d(document).unbind("mouseup")})})};this.onopen=function(){if("function"==
typeof a.options.onopen)a.options.onopen(a)};this.addButton=function(b){b=b||{};b.title=b.title||"OK";b.bclass=b.bclass||"dialog-btn1";b.fn=b.fn||null;b.index=b.index||0;var c=d('<input type="button" class="'+b.bclass+'" value="'+b.title+'">').click(function(){"function"==typeof b.fn&&b.fn(a)});b.index<a.db.find("input").length?a.db.find("input:eq("+b.index+")").before(c):a.db.append(b)};this.show=function(){a.options.showButton&&a.dh.find(".dialog-button").show();"center"==a.options.position?a.setCenterPosition():
"top"==a.options.position?a.setTopPosition():a.setElementPosition();"string"==typeof a.options.showAnimate?a.dh.show(a.options.animate):a.dh.animate(a.options.showAnimate.animate,a.options.showAnimate.speed);a.mh&&a.mh.show()};this.hide=function(b){"string"==typeof a.options.hideAnimate?a.dh.hide(a.options.animate,b):a.dh.animate(a.options.hideAnimate.animate,a.options.hideAnimate.speed,"",b)};this.focus=function(){a.options.focus?(a.dh.find(a.options.focus).focus(),a.dh.find(a.options.focus).focus()):
a.dh.find(".dialog-cancel").focus()};this.find=function(b){return a.dh.find(b)};this.setLoading=function(){a.dh.find(".dialog-button").hide();a.setContent('<div class="dialog-loading"></div>',!0)};this.setWidth=function(b){a.dh.width(b)};this.setTitle=function(b){a.dt.html(b)};this.getTitle=function(){return a.dt.html()};this.setContent=function(b,d){a.dc.html(b);0<a.options.height?a.dc.css("height",a.options.height):a.dc.css("height","auto");0<a.options.width?a.dh.css("width",a.options.width):a.dh.css("width",
"");a.options.showButton&&a.dh.find(".dialog-button").show();90>a.dc.height()&&a.dc.height(90);!0!==d&&a.dc.ready(function(){a.options.isFull&&a.dc.height(a.dc.get(0).scrollHeight);if(null!=a.options.onready)a.options.onready(a)})};this.getContent=function(){return a.dc.html()};this.disabledButton=function(b,d){a.dh.find(".dialog-"+b).attr("disabled",d)};this.hideButton=function(b){a.dh.find(".dialog-"+b).hide()};this.showButton=function(b){a.dh.find(".dialog-"+b).show()};this.setButtonTitle=function(b,
d){a.dh.find(".dialog-"+b).val(d)};this.next=function(b){b=b||{};b.title=b.title||a.getTitle();b.content=b.content||"";b.okname=b.okname||"\u786e\u5b9a";b.width=b.width||260;b.onok=b.onok||a.close;b.onclose=b.onclose||null;b.oncancel=b.oncancel||null;b.hideCancel=b.hideCancel||!0;a.setTitle(b.title);a.setButtonTitle("ok",okname);a.setWidth(width);a.setOnok(b.onok);a.show();""!=b.content&&a.setContent(b.content);b.hideCancel&&a.hideButton("cancel");"function"==typeof b.onclose&&a.setOnclose(b.onclose);
"function"==typeof b.oncancel&&a.setOncancel(b.oncancel)};this.close=function(){if(a.options.isCloseToHide)a.hide(),a.mh.hide();else{if("function"==typeof a.options.onclose)a.options.onclose(a);if("selector"==a.options.contentType)if(a.options.contentChange){var b=a.find(":checkbox");d(a.selector).html(a.getContent());0<b.length&&d(a.selector).find(":checkbox").each(function(a){this.checked=b[a].checked})}else d(a.selector).html(a._content);else"iframe"==a.options.contentType&&a.dh.find(".dialogIframe").removeAttr("src");
a.options.blur&&d(a.options.blur).focus();for(i=0;i<e.length;i++)if(e[i].dh.get(0)==a.dh.get(0)){e.splice(i,1);break}a.hide();a.dh.remove();a.mh&&a.mh.remove()}};this.bheight=function(){if(d.browser.msie&&7>d.browser.version){var a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return a<c?d(window).height():a}return d(document).height()};this.bwidth=function(){if(d.browser.msie&&7>d.browser.version){var a=
Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return a<c?d(window).width():a}return d(document).width()};this.setCenterPosition=function(){var b=d(window),c=d(document),e=c.scrollTop(),c=c.scrollLeft(),e=e+(b.height()-a.dh.height())/2,c=c+(b.width()-a.dh.width())/2;a.dh.css({top:e,left:c})};this.setTopPosition=function(){var b=d(window),c=d(document),e=c.scrollTop(),c=c.scrollLeft(),e=e+a.options.topheight,
c=c+(b.width()-a.dh.width())/2;a.dh.css({top:e,left:c})};this.setElementPosition=function(){var b=d(a.options.position.refele),c=a.options.position.reftop||0,e=a.options.position.refleft||0,f="undefined"==typeof a.options.position.adjust?!0:a.options.position.adjust,k=b.offset().top+b.height();null!=a.options.addtop&&0!=a.options.addtop&&(k+=a.options.addtop);var b=b.offset().left,j=(document.documentElement.scrollTop||document.body.scrollTop)+(document.documentElement.clientHeight||document.body.clientHeight),
l=(document.documentElement.scrollLeft||document.body.scrollLeft)+(document.documentElement.clientWidth||document.body.clientWidth);f&&b+a.dh.width()>l&&(b=l-a.dh.width()-1);f&&k+a.dh.height()>j&&(k=j-a.dh.height()-1);b=Math.max(b+e,0);k=Math.max(k+c,0);a.dh.css({top:k,left:b})};this.initOptions();this.initMask();this.initBox();this.initContent();this.initEvent()};d.extend({weeboxs:new function(){var f=this;this._opening=this._onbox=!1;this.zIndex=999;this.length=function(){return e.length};this.open=
function(c,a){f._opening=!0;"undefined"==typeof a&&(a={});if(a.boxid)for(var b=0;b<e.length;b++)if(e[b].dh.attr("id")==a.boxid){e[b].close();break}a.zIndex=f.zIndex;f.zIndex+=10;b=new n(c,a);b.dh.click(function(){f._onbox=!0});e.push(b);"center"!=b.options.position&&"top"!=b.options.position&&b.setElementPosition();b.mh&&b.mh.css({width:b.bwidth(),height:b.bheight()});return b};this.close=function(){var c=this.getTopBox();if(c){var a=c.dh.attr("id");""!=a&&FANWE.WEEBOX_NOT_CLOSES[a]||c.close()}};
this.getTopBox=function(){return 0<e.length?e[e.length-1]:!1};d(window).scroll(function(){if(0<e.length)for(i=0;i<e.length;i++){var c=e[i];"center"==c.options.position?c.setCenterPosition():"top"==c.options.position?c.setTopPosition():c.setElementPosition();c.mh&&c.mh.css({width:c.bwidth(),height:c.bheight()})}}).resize(function(){if(0<e.length){var c=f.getTopBox();"center"==c.options.position?c.setCenterPosition():"top"==c.options.position&&c.setTopPosition();c.mh&&c.mh.css({width:c.bwidth(),height:c.bheight()})}});
d(document).click(function(c){if(2==c.button)return!0;0<e.length&&(c=f.getTopBox(),!f._opening&&(!f._onbox&&c.options.clickClose)&&c.close());f._opening=!1;f._onbox=!1})}})})(jQuery);
